<!DOCTYPE html>
<html lang="zh-CN" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调查问卷页面</title>
    <style>
        body {
            margin: 10px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        header {
            padding: 10px;
            margin: 10px;
            text-align: center;
        }

        main {
            margin: 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            justify-content: center;
        }

        footer {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }

        button {
            font-size: 20px;
            padding: 10px 20px;
            width: 28vw;
        }

        div{
            height: 45vh;
            width: 70vw;
            display: none;
            padding: 20px;
            margin: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: left;
            background-color: #f9f9f9;
            font-size: 23px;
            overflow-y: auto;
        }

        input {
            margin: 10px auto;
        }

        input[type="radio"],
        input[type="checkbox"]{
            zoom: 140%;
            margin-right: 10px;
        }
        span{
            font-size: 16px;
        }

    </style>
</head>
<body>
<script src="/js/jquery-3.3.1.min.js" type="text/javascript"></script>
<header>
    <p>亲爱的红云朵VIP会员：
        <br>
        您好！欢迎您加入红云朵精准营养健康管理服务中心！每个人都有独特的生活方式，我们希望通过这份健康评测，更深入地了解您的身体健康情况。根据您的评测结论，红云朵权威营养专家将为您提供定制化的健康营养方案，帮助您实现健康目标。现在，就让我们开启这次探索健康之旅吧！</p>
    <input type="text" hidden id="queId" th:value="${queId}"/>
</header>

<main>
    <div id="que_1" >
        <p>1.请填写您的基本信息</p>
        <span>姓名：</span>
        <input type="text" name="name">
        <br>
        <span>生日：</span>
        <select name="year" id="year">
            <!-- 示例数据，实际应替换为适当的年份范围 -->
            <option value="1930">1930</option>
            <option value="1931">1931</option>
            <option value="1932">1932</option>
            <option value="1933">1933</option>
            <option value="1934">1934</option>
            <option value="1935">1935</option>
            <option value="1936">1936</option>
            <option value="1937">1937</option>
            <option value="1938">1938</option>
            <option value="1939">1939</option>

            <option value="1940">1940</option>
            <option value="1941">1941</option>
            <option value="1942">1942</option>
            <option value="1943">1943</option>
            <option value="1944">1944</option>
            <option value="1945">1945</option>
            <option value="1946">1946</option>
            <option value="1947">1947</option>
            <option value="1948">1948</option>
            <option value="1949">1949</option>

            <option value="1950">1950</option>
            <option value="1951">1951</option>
            <option value="1952">1952</option>
            <option value="1953">1953</option>
            <option value="1954">1954</option>
            <option value="1955">1955</option>
            <option value="1956">1956</option>
            <option value="1957">1957</option>
            <option value="1958">1958</option>
            <option value="1959">1959</option>

            <option value="1960">1960</option>
            <option value="1961">1961</option>
            <option value="1962">1962</option>
            <option value="1963">1963</option>
            <option value="1964">1964</option>
            <option value="1965">1965</option>
            <option value="1966">1966</option>
            <option value="1967">1967</option>
            <option value="1968">1968</option>
            <option value="1969">1969</option>

            <option value="1970">1970</option>
            <option value="1971">1971</option>
            <option value="1972">1972</option>
            <option value="1973">1973</option>
            <option value="1974">1974</option>
            <option value="1975">1975</option>
            <option value="1976">1976</option>
            <option value="1977">1977</option>
            <option value="1978">1978</option>
            <option value="1979">1979</option>

            <option value="1980">1980</option>
            <option value="1981">1981</option>
            <option value="1982">1982</option>
            <option value="1983">1983</option>
            <option value="1984">1984</option>
            <option value="1985">1985</option>
            <option value="1986">1986</option>
            <option value="1987">1987</option>
            <option value="1988">1988</option>
            <option value="1989">1989</option>

            <option value="1990">1990</option>
            <option value="1991">1991</option>
            <option value="1992">1992</option>
            <option value="1993">1993</option>
            <option value="1994">1994</option>
            <option value="1995">1995</option>
            <option value="1996">1996</option>
            <option value="1997">1997</option>
            <option value="1998">1998</option>
            <option value="1999">1999</option>

            <option value="2000">2000</option>
            <option value="2001">2001</option>
            <option value="2002">2002</option>
            <option value="2003">2003</option>
            <option value="2004">2004</option>
            <option value="2005">2005</option>
            <option value="2006">2006</option>
            <option value="2007">2007</option>
            <option value="2008">2008</option>
            <option value="2009">2009</option>

            <option value="2010">2010</option>
            <option value="2011">2011</option>
            <option value="2012">2012</option>
            <option value="2013">2013</option>
            <option value="2014">2014</option>
            <option value="2015">2015</option>
            <option value="2016">2016</option>
            <option value="2017">2017</option>
            <option value="2018">2018</option>
            <option value="2019">2019</option>

            <option value="2020">2020</option>
            <option value="2021">2021</option>
            <option value="2022">2022</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>

        </select>
        <span>年</span>
        <select name="month" id="month">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
        </select>
        <span>月</span>
        <select name="day" id="day">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
            <option value="31">31</option>
        </select>
        <span>日</span>
        <br>
        <span>性别：</span>
        <input type="radio" name="gender" value="男" checked> <span>男</span>
        <input type="radio" name="gender" value="女"> <span>女</span>
        <br>
        <span>身高：</span>
        <input type="text" name="height" placeholder="单位 (cm)">
        <br>
        <span>体重：</span>
        <input type="text" name="weight" placeholder="单位 (kg)">
        <br>
        <span>腰围：</span>
        <input type="text" name="waist" placeholder="单位 (cm)">&nbsp;&nbsp;&nbsp;&nbsp;<span>腰围80厘米相当于2尺4</span>

    </div>
    <div id="que_2">
        <p>1.您的直系亲属（父母/祖父母/外祖父母）患有以下疾病吗？</p>
        <input type="checkbox" name="familyDisease" value="高血压">A.高血压
        <br>
        <input type="checkbox" name="familyDisease" value="糖尿病">B.糖尿病
        <br>
        <input type="checkbox" name="familyDisease" value="高脂血症">C.高脂血症
        <br>
        <input type="checkbox" name="familyDisease" value="冠心病">D.冠心病
        <br>
        <input type="checkbox" name="familyDisease" value="脑卒中">E.脑卒中
        <br>
        <input type="checkbox" name="familyDisease" value="肥胖">F.肥胖
        <br>
        <input type="checkbox" name="familyDisease" value="以上都无">G.以上都无
    </div>
    <div id="que_3">
        <p>2.您是否被医院诊断为以下代谢疾病?</p>
        <input type="checkbox" name="metabolicDiseases" value="糖尿病">A. 糖尿病
        <br>
        <input type="checkbox" name="metabolicDiseases" value="高脂血症">B. 高脂血症
        <br>
        <input type="checkbox" name="metabolicDiseases" value="高血压">C. 高血压
        <br>
        <input type="checkbox" name="metabolicDiseases" value="脑血管病(脑出血、脑卒中)">D. 脑血管病(脑出血、脑卒中)
        <br>
        <input type="checkbox" name="metabolicDiseases" value="无">E. 无
    </div>
    <div id="que_4">
        <p>3.您一周的喝酒量是?</p>
        <input type="radio" name="drinkWeek" value="普通瓶装啤酒8瓶/白酒400m/红酒2瓶">A.普通瓶装啤酒8瓶/白酒400m/红酒2瓶
        <br>
        <input type="radio" name="drinkWeek" value="少量饮酒">B.少量饮酒
        <br>
        <input type="radio" name="drinkWeek" value="不喝酒">C.不喝酒
    </div>
    <div id="que_5">
        <p>4.您平时的烟草接触情况？</p>
        <input type="radio" name="smoking" value="平时抽烟">A.平时抽烟
        <br>
        <input type="radio" name="smoking" value="不抽烟但会接触二手烟">B.不抽烟但会接触二手烟
        <br>
        <input type="radio" name="smoking" value="不抽烟也不接触二手烟">C.不抽烟也不接触二手烟
    </div>
    <div id="que_6">
        <p>5.您一天的睡眠时长是?</p>
        <input type="radio" name="sleepOneDay" value="高于6小时/天">A. 高于6小时/天
        <br>
        <input type="radio" name="sleepOneDay" value="低于6个小时/天">B.低于6个小时/天
    </div>
    <div id="que_7">
        <p>6.您的睡眠质量怎么样?</p>
        <input type="checkbox" name="sleepQuality" value="入睡困难">A.入睡困难
        <br>
        <input type="checkbox" name="sleepQuality" value="容易醒">B.容易醒
        <br>
        <input type="checkbox" name="sleepQuality" value="多梦(一晚上都在做梦，且回想不起来梦过什么)">C.多梦(一晚上都在做梦，且回想不起来梦过什么)
        <br>
        <input type="checkbox" name="sleepQuality" value="比较好">D.比较好
    </div>
    <div id="que_8">
        <p>7.您是否长期处于紧张焦虑当中或高压力工作中?</p>
        <input type="radio" name="work" value="是">A.是
        <br>
        <input type="radio" name="work" value="偶尔会有一段时间焦虑">B.偶尔会有一段时间焦虑
        <br>
        <input type="radio" name="work" value="否">C.否
    </div>
    <div id="que_9">
        <p>8.您每天的运动量?</p>
        <input type="radio" name="amount" value="平时都会做适量运动">A.平时都会做适量运动
        <br>
        <input type="radio" name="amount" value="只有上下班走走路">B.只有上下班走走路
        <br>
        <input type="radio" name="amount" value="只做做家务">C.只做做家务
        <br>
        <input type="radio" name="amount" value="几乎不动，久坐，下班开车">D.几乎不动，久坐，下班开车
        <br>
        <input type="radio" name="amount" value="去健身房锻炼">E.去健身房锻炼
    </div>
    <div id="que_10">
        <p>9.您的排便情况?</p>
        <input type="checkbox" name="defecation" value="大便不成形，粘滞不易冲冲">A.大便不成形，粘滞不易冲冲
        <br>
        <input type="checkbox" name="defecation" value="排便气味重">B.排便气味重
        <br>
        <input type="checkbox" name="defecation" value="颜色非黄或黄褐色">C.颜色非黄或黄褐色
        <br>
        <input type="checkbox" name="defecation" value="便秘">D.便秘
        <br>
        <input type="checkbox" name="defecation" value="经常腹泻">E.经常腹泻
        <br>
        <input type="checkbox" name="defecation" value="无以上症状">F.无以上症状
    </div>
    <div id="que_11">
        <p>10.以下描述哪项更贴近您的饮食习惯?</p>
        <input type="checkbox" name="foodShort" value="平时特别喜欢吃咸的，味比较重的食物(包括炒菜、腌菜和卤制品等)?">A. 平时特别喜欢吃咸的，味比较重的食物(包括炒菜、腌菜和卤制品等)?
        <br>
        <input type="checkbox" name="foodShort" value="蔬菜、水果摄入少 (每日蔬菜摄入量<300g)">B.蔬菜、水果摄入少 (每日蔬菜摄入量<300g)
        <br>
        <input type="checkbox" name="foodShort" value="经常喝含糖饮料或吃甜品等高糖食品">C.经常喝含糖饮料或吃甜品等高糖食品
        <br>
        <input type="checkbox" name="foodShort" value="喜欢吃肉类或加工肉制品(火腿、培根等)">D.喜欢吃肉类或加工肉制品(火腿、培根等)
        <br>
        <input type="checkbox" name="foodShort" value="主食吃的都是精加工谷物(精米白面)，几乎不吃粗粮类食物">E.主食吃的都是精加工谷物(精米白面)，几乎不吃粗粮类食物
        <br>
        <input type="checkbox" name="foodShort" value="经常在外就餐或点外卖">F.经常在外就餐或点外卖
        <br>
        <input type="checkbox" name="foodShort" value="爱吃烧烤、油炸、腌制食物">G.爱吃烧烤、油炸、腌制食物
        <br>
        <input type="checkbox" name="foodShort" value="饮水量<1500ml">H.饮水量<1500ml
        <br>
        <input type="checkbox" name="foodShort" value="无以上任何习惯">I.无以上任何习惯
    </div>
    <div id="que_12">
        <p>11.您是否有以下症状？</p>
        <input type="checkbox" name="otherDisease" value="疲劳、精力不济">A.疲劳、精力不济
        <br>
        <input type="checkbox" name="otherDisease" value="虚弱、经常犯困">B.虚弱、经常犯困
        <br>
        <input type="checkbox" name="otherDisease" value="容易感冒、反复感染">C.容易感冒、反复感染
    </div>
    <div id="que_13">
        <p>12.目前最想解决的健康问题（单选）？</p>
        <input type="radio" name="needs" value="高血压">A.高血压
        <br>
        <input type="radio" name="needs" value="高血脂">B.高血脂
        <br>
        <input type="radio" name="needs" value="高血糖">C.高血糖
        <br>
        <input type="radio" name="needs" value="肠道健康">D.肠道健康
        <br>
        <input type="radio" name="needs" value="免疫力">E.免疫力
    </div>
</main>
<footer>
    <button class="prev" >上一题</button>
    <button class="submit" >提交</button>
    <button class="next">下一题</button>
</footer>
<script type="text/javascript">
    var base_div_clazz = "que_";
    const div_list = ["que_1","que_2","que_3","que_4","que_5","que_6","que_7","que_8","que_9","que_10","que_11","que_12","que_13"];
    function divDisplayNone(que_no){
        //将所有的div隐藏
        $.each(div_list,function(index,v){
            document.getElementById(v).style.display = "none";
        });
        document.getElementById(base_div_clazz+que_no).style.display = "block";
    }
    function getDaysInFebruary(year) {
        // 2月份的天数可以通过检查这年的3月1日前一天是几号来确定
        return new Date(year, 2, 0).getDate();
    }
    $(function (){
        var qId = $("#queId").val();
        var que_no = 1;
        //页面加载后显示第一个div
        document.getElementById(base_div_clazz+que_no).style.display = "block";
        document.getElementById('year').value = '1990';
        $(".prev").prop("disabled", true);
        $(".submit").prop("disabled", true);
        $(".next").click(function (){
            que_no ++;
            $(".prev").prop("disabled", false);
            if(que_no === div_list.length){
                $(".submit").prop("disabled", false);
                $(this).prop("disabled",true);
            }
            //将所有div隐藏，并展示当前需要展示的对应que_1，2，3，4等div
            divDisplayNone(que_no);
        });
        $(".prev").click(function (){
            que_no --;
            if(que_no === 1){
                $(this).prop("disabled", true);
            }
            $(".submit").prop("disabled", true);
            $(".next").prop("disabled", true);
            divDisplayNone(que_no);
        });

        $(".submit").click(function(){
            //que_1
            let name = $("[name='name']").val();
            let year = $("#year").val();
            let month = $("#month").val();
            let day = $("#day").val();
            let gender = $("[name='gender']").val();
            let height = $("[name='height']").val();
            let weight = $("[name='weight']").val();
            let waist = $("[name='waist']").val();
            //que_2
            let familyDisease = [];
            $("input[name='familyDisease']:checked").each(function (){
                familyDisease.push($(this).val());
            });
            //que_3
            let metabolicDiseases = [];
            $("input[name='metabolicDiseases']:checked").each(function(){
                metabolicDiseases.push($(this).val());
            });
            //que_4
            let drinkWeek = $("input[name='drinkWeek']:checked").val();
            //que_5
            let smoking = $("input[name='smoking']:checked").val();
            //que_6
            let sleepOneDay = $("input[name='sleepOneDay']:checked").val();
            //que_7
            let sleepQuality = [];
            $("input[name='sleepQuality']:checked").each(function(){
                sleepQuality.push($(this).val());
            });
            //que_8
            let work = $("[name='work']:checked").val();
            //que_9
            let amount = $("[name='amount']:checked").val();
            //que_10
            let defecation = [];
            $("input[name='defecation']:checked").each(function(){
                defecation.push($(this).val());
            });
            //que_11
            let foodShort = [];
            $("input[name='foodShort']:checked").each(function(){
                foodShort.push($(this).val());
            });
            //que_12
            let otherDisease = [];
            $("input[name='otherDisease']:checked").each(function(){
                otherDisease.push($(this).val());
            });
            //que_13
            let needs = $("[name='needs']:checked").val();
            let label = needs;
            let otherText = {
                "name":name,
                "familyDisease":familyDisease,
                "metabolicDiseases":metabolicDiseases,
                "drinkWeek":drinkWeek,
                "smoking":smoking,
                "sleepOneDay":sleepOneDay,
                "sleepQuality":sleepQuality,
                "work":work,
                "amount":amount,
                "defecation":defecation,
                "foodShort":foodShort,
                "otherDisease":otherDisease,
                "needs":needs
            }
            let queData = {
                "queId":qId,
                "birthday":year + "-" + month + "-" +day,
                "gender":gender,
                "height":height,
                "weight":weight,
                "waist":waist,
                "label":label,
                "otherText":JSON.stringify(otherText)
            }
            console.log(queData)
            //填写完成后，ajax提交
            $.ajax({
                url:"/question/createQuestion",
                type:"POST",
                data:queData,
                success:function (data) {
                    console.log(data);
                    /*if(data === "success"){
                        if(needs === "高血压"){
                            window.location.href = "/page/gotoDisease?disease=gaoxueya&name="+name;
                        }else if(needs === "高血脂"){
                            window.location.href = "/page/gotoDisease?disease=gaoxuezhi&name="+name;
                        }else if(needs === "高血糖"){
                            window.location.href = "/page/gotoDisease?disease=gaoxuetang&name="+name;
                        }else if(needs === "肠道健康"){
                            window.location.href = "/page/gotoDisease?disease=changdaojiankang&name="+name;
                        }else {
                            window.location.href = "/page/gotoDisease?disease=mianyili&name="+name;
                        }
                    }else {
                        alert("哎呀出错了！")
                    }*/
                }
            });
        });

        $("#month").change(function(){
            let year = $("#year").val();
            let month = $(this).val();
            if(month === "1" || month === "3" || month === "5" || month === "7" || month === "8" || month === "10" || month === "12"){
                $("#day").empty();
                $("#day").append(`
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                    `)
            }
            if(month === "4" || month === "6" || month === "9" || month === "11"){
                $("#day").empty();
                $("#day").append(`
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    `)
            }
            if(month == "2"){
                $("#day").empty();
                //根据年份计算天数
                let days = getDaysInFebruary(year);
                if(days === 28){
                    $("#day").append(`
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        `)
                }else{
                    $("#day").append(`
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        `)
                }

            }
        });
    });
</script>
</body>
</html>